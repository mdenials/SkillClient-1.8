package com.skillclient.modules.exploit;

import net.minecraft.network.Packet;
import com.skillclient.wrapper.SkillWrapper;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.util.Vec3d;
import net.minecraft.util.MovingObjectPosition;
import com.skillclient.main.Register;
import com.skillclient.misc.Module;

public class Teleport extends Module
{
    public Teleport() {
        super("Teleport", Register.Category.EXPLOIT, "Teleport around :)");
        this.modes = 1;
    }
    
    public void onEnable() {
        final MovingObjectPosition ray = this.rayTrace(500.0);
        if (ray == null) {
            return;
        }
        final double x_new = ray.getBlockPos().getX() + 0.5;
        final double y_new = ray.getBlockPos().getY() + 1;
        final double z_new = ray.getBlockPos().getZ() + 0.5;
        for (double distance = Teleport.mc.thePlayer.getDistance(x_new, y_new, z_new), d = 0.0; d < distance; d += 2.0) {
            this.setPos(Teleport.mc.thePlayer.posX + (x_new - Teleport.mc.thePlayer.getHorizontalFacing().getFrontOffsetX() - Teleport.mc.thePlayer.posX) * d / distance, Teleport.mc.thePlayer.posY + (y_new - Teleport.mc.thePlayer.posY) * d / distance, Teleport.mc.thePlayer.posZ + (z_new - Teleport.mc.thePlayer.getHorizontalFacing().getFrontOffsetZ() - Teleport.mc.thePlayer.posZ) * d / distance);
        }
        this.setPos(x_new, y_new, z_new);
        Teleport.mc.renderGlobal.loadRenderers();
    }
    
    public MovingObjectPosition rayTrace(final double blockReachDistance) {
        final Vec3d vec3 = Teleport.mc.thePlayer.getPositionEyes(1.0f);
        final Vec3d vec4 = Teleport.mc.thePlayer.getLookVec();
        final Vec3d vec5 = vec3.addVector(vec4.xCoord * blockReachDistance, vec4.yCoord * blockReachDistance, vec4.zCoord * blockReachDistance);
        return Teleport.mc.theWorld.rayTraceBlocks(vec3, vec5, !Teleport.mc.thePlayer.isInWater(), false, false);
    }
    
    public void setPos(final double x, final double y, final double z) {
        SkillWrapper.sendPacket((Packet)new C03PacketPlayer.C04PacketPlayerPosition(x, y, z, true));
        Teleport.mc.thePlayer.setPosition(x, y, z);
    }
}

